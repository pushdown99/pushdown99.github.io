---
layout: post
title: 'vagrant' 
author: haeyeon.hwang
tags: [Kubernetes, k8s]
description: >
  ì¿ ë²„ë„¤í‹°ìŠ¤ ê¸°ë³¸ ë‚´ìš© 
image: /assets/img/blog/k8s_components.png
hide_image: true
---

## Kubernetes ê¸°ë³¸ ì‚¬ìš© 

ì°¸ê³ ì‚¬ì´íŠ¸: https://brunch.co.kr/@sokoban/81


![app_deployment](/assets/img/blog/app_deployment.png)

### Kubernetes Object

- Namespace: í•˜ë‚˜ì˜ ë¬¼ë¦¬ í´ëŸ¬ìŠ¤í„° ì•ˆì—ì„œ ì—¬ëŸ¬ê°œì˜ ê°€ìƒ í´ëŸ¬ìŠ¤í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŸ¬í•œ ê°€ìƒ í´ëŸ¬ìŠ¤í„°ëŠ” Namespace ê¸°ë°˜ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì‚¬ìš© ê°€ëŠ¥í•¨.
- ì¦‰, í´ëŸ¬ìŠ¤í„°ì—ì„œ ì—¬ëŸ¬ê°œì˜ ì•±ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ì—¬ë¼ëª…ì˜ ì‚¬ìš©ìê°€ ì‚¬ìš©í•´ì•¼ í•  ë•Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥í•¨.

~~~console
kubectl get namespace

NAME                   STATUS   AGE
default                Active   12d
kube-node-lease        Active   12d
kube-public            Active   12d
kube-system            Active   12d
kubernetes-dashboard   Active   12d
~~~

~~~console
kubectl config current-context

docker-desktop
~~~

~~~console
kubectl config set-context docker-desktop --namespace=kube-system

Context "docker-desktop" modified.
~~~


### Kubernetes ìš©ì–´ ì •ë¦¬

ìš©ì–´|ì„¤ëª…
---|---
Deployment|Podì˜ ì„¤ì¹˜ê´€ë¦¬í•˜ëŠ” ê¸°ë³¸ìš”ì†Œë¡œì„œ, ì‹¤í–‰ì‹œì˜ ê¸°ë³¸ ì»¨íŠ¸ë¡¤ëŸ¬, Deployment ì‚­ì œ ì‹œ í•˜ë¶€ì˜ Podë„ ëª¨ë‘ ì‚­ì œë¨.
Service|Podì—ì„œ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•œ ì‹ ì›(Identity)ì„ ì œê³µí•˜ì—¬ ì„œë¹„ìŠ¤ ì°¾ê¸°ë¥¼ í†µí•´ì„œ Podì— ê³ ìœ í•œ IPì£¼ì†Œì™€ Pod ì§‘í•©ì— ëŒ€í•œ ë‹¨ì¼ DNSëª…ì„ ë¶€ì—¬í•˜ì—¬ ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•¨. Type = {ClusterIP, NodePort, LoadBalancer, ExternalName}
Pod|ì‹¤ì œ ë„ì»¤ ì¸ìŠ¤í„´ìŠ¤ê°€ ë–  ìˆëŠ” ë‹¨ìœ„ë¥¼ Podë¡œ ì§€ì¹­

### Kubernetes ë…¸ë“œ êµ¬ì„±

ë…¸ë“œ|ì„¤ëª…
---|---
Master|ë…¸ë“œë“¤ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ì œì–´, 1ëŒ€ë§Œ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë‚˜ ê³ ê°€ìš©ì„± ì„œë¹„ìŠ¤ë¼ë©´ **3ëŒ€ ì´ìƒ**ìœ¼ë¡œ êµ¬ì„±. ì¥ì• ê°€ ë°œìƒí•˜ë©´, ë‚¨ì€ ì„œë²„ ì¤‘ í•œëŒ€ê°€ ë§ˆìŠ¤í„° ì—­í• ì„ í•¨.
Node (Worker)|Kubelet, kube-proxy, docker ë“±ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‘í•˜ë©° ë§ˆìŠ¤í„°ë…¸ë“œì˜ ëª…ë ¹ì„ ë°›ì•„ ì‚¬ìš©ìê°€ ì„ ì–¸í•œ Podë‚˜ Jobì„ ì‹¤í–‰í•¨. ì‹¤ì œ docker ì»¨í…Œì´ë„ˆê°€ ë™ì‘í•˜ëŠ” ê²ƒì€ ë…¸ë“œì—ì„œ ë™ì‘í•¨.

### Kubernetes êµ¬ì„± ìš”ì†Œ

#### Master Node êµ¬ì„±ìš”ì†Œ

êµ¬ì„±ìš”ì†Œ|ì„¤ëª…
---|---
kube-scheduler|í´ëŸ¬ìŠ¤í†  ë‚´ì—ì„œ ë°œìƒí•˜ëŠ” íŒŒë“œì˜ ìƒì„±ì— ëŒ€í•œ ë…¸ë“œì˜ ìì›í• ë‹¹ì„ ì„ íƒí•˜ëŠ” ì»´í¬ë„ŒíŠ¸, ì •í•´ë†“ì€ ì¡°ê±´ì— ë§ê²Œ ë¹ˆ ë…¸ë“œì— íŒŒë“œë¥¼ í• ë‹¹. í• ë‹¹ì€ {affinity, anti-affinity, ë°ì´í„°ì§€ì—­ì„± ë“±} ë‹¤ì–‘í•œ ìš”ì†Œë¥¼ ê³ ë ¤í•¨
kube-contoller-manager|í† ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ ì™¸ì— ì•„ë˜ì˜ ë‹¤ìˆ˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë³µì¡ì„±ì„ ì¤„ì´ê¸° ìœ„í•´ì„œ í•˜ë‚˜ë¡œ êµ¬ì„±í•œ ì»´í¬ë„ŒíŠ¸ë¡œì„œ ê° ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŒ. </br></br><table><tr><th>ì¢…ë¥˜</th><th>ì„¤ëª…</th></tr><tr><td>ë…¸ë“œì»¨íŠ¸ë¡¤ëŸ¬</td><td>ë…¸ë“œì˜ ì¤‘ì§€ì— ëŒ€í•œ ëŒ€ì‘</td></tr><tr><td>ë˜í”Œë¦¬ì¼•ë¦¬ì…˜ì»¨íŠ¸ë¡¤ëŸ¬</td><td>ì „ì²´ ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ ê°ì²´ì— ëŒ€í•œ íŒŒë“œ ìˆ«ì ìœ ì§€</td></tr><tr><td>ì—”ë“œí¬ì¸íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬</td><td>ì„œë¹„ìŠ¤ì™€ íŒŒë“œì˜ ì—°ê²°</td></tr><tr><td>ì„œë¹„ìŠ¤ì–´ì¹´ìš´íŠ¸ & í† í°ì»¨íŠ¸ë¡¤ëŸ¬</td><td>ì‹ ê·œ Namespaceì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ê´€ë¦¬</td></tr></table>
cloud-controller-manager|í´ë¼ìš°ë“œ ì‚¬ì—…ìì™€ ì»¨íŠ¸ë¡¤ëŸ¬ ë“¤ì„ ì—°ê²°í•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰</br></br><table><tr><th>ì¢…ë¥˜</th><th>ì„¤ëª…</th></tr><tr><td>ë…¸ë“œì»¨íŠ¸ë¡¤ëŸ¬</td><td>ë…¸ë“œì˜ ì¤‘ì§€ ì´í›„ í´ë¼ìš°ë“œ ìƒì—ì„œ ì‚­ì œë˜ì—ˆëŠ”ì§€ íŒë³„</td></tr><tr><td>ë¼ìš°íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬</td><td>í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ìƒì˜ ë„¤íŠ¸ì›Œí¬ ë¼ìš°íŒ… ê´€ë¦¬</td></tr><tr><td>ì„œë¹„ìŠ¤ì»¨íŠ¸ë¡¤ëŸ¬</td><td>í´ë¼ìš°ë“œ ì œê³µì‚¬ì—…ì ì„œë¹„ìŠ¤ì˜ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ìƒì„±, ì—…ë°ì´íŠ¸ ì‚­ì¬</td></tr><tr><td>ë³¼ë¥¨ì»¨íŠ¸ë¡¤ëŸ¬</td><td>í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ìƒì˜ ë³¼ë¥¨ì„ ë…¸ë“œì™€ ì—°ê²°í•˜ê±°ë‚˜ ë§ˆìš´íŠ¸</td></tr></table>
kube-apiserver|ì¿ ë²„ë„¤í‹°ìŠ¤ìƒì—ì„œ ì´ë¤„ì§€ëŠ” ëª¨ë“  ìš”ì²­ì€ ì´ë¥¼ í†µí•´ì„œ ê° ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬ë˜ê³  ì‹¤í–‰ë¨. ì™¸ë¶€ì—ì„œ í´ë¼ìš°ë“œë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” í•µì‹¬ API, ìˆ˜í‰í™•ì¥ì´ ê°€ëŠ¥í•˜ë¯€ë¡œ ìš”ì²­ì´ ë§ì€ ê²½ìš° í™•ì¥í•  ìˆ˜ ìˆìŒ.
etcd|key-value ì €ì¥ì†Œë¡œì„œ ëª¨ë“  í´ëŸ¬ìŠ¤í„°ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì €ì¥ì†Œ ([https://etcd.io](https://etcd.io))

#### Worker Node êµ¬ì„±ìš”ì†Œ

êµ¬ì„±ìš”ì†Œ|ì„¤ëª…
---|---
kubelet|í”„ë¡œì„¸ìŠ¤íŠ¸ë¡œì„œ ì‹¤í–‰ê°€ëŠ¥í•˜ë©° ë„ì»¤ë¥¼ ê´€ë¦¬. kube-apiserverì™€ í†µì‹ í•˜ë©´ì„œ íŒŒë“œì˜ ìƒì„±, ê´€ë¦¬, ì‚­ì œë¥¼ ë‹´ë‹¹í•¨
kube-proxy|ê°œë³„ ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ í”„ë¡ì‹œë¡œì„œ íŒŒë“œê°€ ì™¸ë¶€ì™€ í†µì‹ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë“± ë„¤íŠ¸ì›Œí¬ ê·œì¹™ì„ ê´€ë¦¬
ì»¨í…Œì´ë„ˆëŸ°íƒ€ì„|í´ëŸ¬ìŠ¤í„°ë¡œì„œ ì»¨í…Œì´ë„ˆì˜ ì‹¤í–‰ì„ ë‹´ë‹¹í•˜ëŠ” ê²ƒìœ¼ë¡œì„œ ëŒ€í‘œì ìœ¼ë¡œëŠ” Dockerê°€ ìˆìœ¼ë©°, containerdì™€ ê°™ì€ ë‹¤ë¥¸ ëŸ°íƒ€ì„ë„ ì§€ì›. CRI(Container Runtime Interface)ì„ ë§Œì¡±í•˜ëŠ” ëª¨ë“  ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì§€ì› í•¨

![k8s_components](/assets/img/blog/k8s_components.png)

### Kubernetes ëŒ€ì‹œë³´ë“œ ì‹¤í–‰

#### on PowerShell

~~~console
kubectl

Starting to serve on 127.0.0.1:8001
~~~

#### on Brolwser

~~~console
http://127.0.0.1:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login
~~~

ë‹¤ìŒê³¼ ê°™ì€ ì¸ì¦í™”ë©´ì´ ë‚˜ì˜´

![k8s_dashboard_auth](/assets/img/blog/k8s_dashboard_auth.png)

í† í°ê°’ êµ¬í•˜ê¸°

~~~console
kubectl get serviceaccount

NAME                                          SECRETS   AGE
attachdetach-controller                       0         12d
bootstrap-signer                              0         12d
certificate-controller                        0         12d
clusterrole-aggregation-controller            0         12d
coredns                                       0         12d
cronjob-controller                            0         12d
daemon-set-controller                         0         12d
default                                       0         12d
deployment-controller                         0         12d
disruption-controller                         0         12d
endpoint-controller                           0         12d
endpointslice-controller                      0         12d
endpointslicemirroring-controller             0         12d
ephemeral-volume-controller                   0         12d
expand-controller                             0         12d
generic-garbage-collector                     0         12d
horizontal-pod-autoscaler                     0         12d
job-controller                                0         12d
kube-proxy                                    0         12d
legacy-service-account-token-cleaner          0         12d
namespace-controller                          0         12d
node-controller                               0         12d
persistent-volume-binder                      0         12d
pod-garbage-collector                         0         12d
pv-protection-controller                      0         12d
pvc-protection-controller                     0         12d
replicaset-controller                         0         12d
replication-controller                        0         12d
resourcequota-controller                      0         12d
root-ca-cert-publisher                        0         12d
service-account-controller                    0         12d
service-controller                            0         12d
statefulset-controller                        0         12d
storage-provisioner                           0         12d
token-cleaner                                 0         12d
ttl-after-finished-controller                 0         12d
ttl-controller                                0         12d
validatingadmissionpolicy-status-controller   0         12d
vpnkit-controller                             0         12d
~~~

~~~console
kubectl get serviceaccount default -o yaml

apiVersion: v1
kind: ServiceAccount
metadata:
  creationTimestamp: "2024-11-12T04:24:43Z"
  name: default
  namespace: kube-system
  resourceVersion: "281"
  uid: 28bb9d1f-36ab-43f7-a808-e66a15b70f5d

or (< Kubernetes 1.24)

apiVersion: v1
kind: ServiceAccount
metadata:
  creationTimestamp: "2024-11-12T04:24:43Z"
  name: default
  namespace: kube-system
  resourceVersion: "281"
  uid: 28bb9d1f-36ab-43f7-a808-e66a15b70f5d
  secrets:
    - name: ********
  ~~~

#### Kubernetes 1.24 í•˜ìœ„ ë²„ì „ì˜ ê²½ìš°, ìˆ˜ì‹ ëœ secretì„ ê°€ì§€ê³  í† í°ì„ êµ¬í•˜ë©´ ë¨.

  ~~~console
  kubectl describe secret ********
  ~~~

#### Kubernetes 1.24 >= ë²„ì „ì˜ ê²½ìš°, ì§ì ‘ í† í°ì„ ìƒì„±í•¨.

~~~console
kubectl create token default 

eyJhbGciOiJSUzI1NiIsImtpZCI6IjZKc1lXemM1ZDM0UnZwYmZsLWt0bUt2ck5XeFFHUHJqbEhOYVdOdXRKNGsifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzMyNTA2Nzk3LCJpYXQiOjE3MzI1MDMxOTcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMjg2MjNlMWYtZTY0Yy00ZjEyLWE4ODEtNjY0MTAwZWU0NWIyIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkZWZhdWx0IiwidWlkIjoiMjhiYjlkMWYtMzZhYi00M2Y3LWE4MDgtZTY2YTE1YjcwZjVkIn19LCJuYmYiOjE3MzI1MDMxOTcsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTpkZWZhdWx0In0.bGbAbkgO3fag_GP5F43mPgYrh6D-LlFDSwHCx_vcPshusRfprRpzmMZdsnQtM8coiRDXFFZp22FLxObVUl0sBgtEstGskIatnambntGKt4k8ge34r6OlPr6FjQxWWOjlHxXn-dvewOvQ2Ne3iP_RWJsIhWwV6fjWf6O-vZMH1YosQQ99c-bnIeg4cx3CLGAin1gtmNFzhzvWOgw-IdAdbfbNxuFta81z6HNsgO8lPxom7eygh6a4EgbTKXCtGBw4fZoRqiK6dJKE9GT-59xEpMogu4aUFDeIDwX40VbwDTcQG73e_3dvzZKdF9SYZ09prYu5Y_uN8Y3NEp5t_jQMwg
~~~

ìƒì„±ëœ í† í°ì„ ì´ìš©í•œ ì ‘ì†

![k8s_dashboard_login](/assets/img/blog/k8s_dashboard_login.png)

~~~console
kubectl get services --v=7

I1125 11:57:17.822098   27680 loader.go:395] Config loaded from file:  C:\Users\í™©í•´ì—°\.kube\config
I1125 11:57:17.841223   27680 round_trippers.go:463] GET https://kubernetes.docker.internal:6443/api/v1/namespaces/kube-system/services?limit=500
I1125 11:57:17.841223   27680 round_trippers.go:469] Request Headers:
I1125 11:57:17.841739   27680 round_trippers.go:473]     Accept: application/json;as=Table;v=v1;g=meta.k8s.io,application/json;as=Table;v=v1beta1;g=meta.k8s.io,application/json
I1125 11:57:17.841739   27680 round_trippers.go:473]     User-Agent: kubectl.exe/v1.31.2 (windows/amd64) kubernetes/5864a46
I1125 11:57:17.863147   27680 round_trippers.go:574] Response Status: 200 OK in 20 milliseconds
NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE
kube-dns   ClusterIP   10.96.0.10   <none>        53/UDP,53/TCP,9153/TCP   12d
~~~

~~~console
kubectl api-versions

admissionregistration.k8s.io/v1
apiextensions.k8s.io/v1
apiregistration.k8s.io/v1
apps/v1
authentication.k8s.io/v1
authorization.k8s.io/v1
autoscaling/v1
autoscaling/v2
batch/v1
certificates.k8s.io/v1
coordination.k8s.io/v1
discovery.k8s.io/v1
events.k8s.io/v1
flowcontrol.apiserver.k8s.io/v1
flowcontrol.apiserver.k8s.io/v1beta3
networking.k8s.io/v1
node.k8s.io/v1
policy/v1
rbac.authorization.k8s.io/v1
scheduling.k8s.io/v1
storage.k8s.io/v1
v1
~~~

### Kubernetes ì ‘ê·¼ì„¤ì • ë³€ê²½

#### Kubernetes Context ë³€ê²½

~~~console
kubectl config view

apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: DATA+OMITTED
    server: https://kubernetes.docker.internal:6443
  name: docker-desktop
contexts:
- context:
    cluster: docker-desktop
    namespace: kube-system
    user: docker-desktop
  name: docker-desktop
current-context: docker-desktop
kind: Config
preferences: {}
users:
- name: docker-desktop
  user:
    client-certificate-data: DATA+OMITTED
    client-key-data: DATA+OMITTED
~~~

ë³„ë„, minikube ì„¤ì¹˜ [minikube](https://minikube.sigs.k8s.io/docs/start/?arch=%2Fwindows%2Fx86-64%2Fstable%2F.exe+download)

![minikube_start](/assets/img/blog/minikube_start.png)

~~~console
minikube start

ğŸ˜„  minikube v1.34.0 on Microsoft Windows 11 Pro 10.0.22631.4460 Build 22631.4460
âœ¨  Automatically selected the docker driver. Other choices: virtualbox, ssh
ğŸ“Œ  Using Docker Desktop driver with root privileges
ğŸ‘  Starting "minikube" primary control-plane node in "minikube" cluster
ğŸšœ  Pulling base image v0.0.45 ...
ğŸ’¾  Downloading Kubernetes v1.31.0 preload ...
    > preloaded-images-k8s-v18-v1...:  326.69 MiB / 326.69 MiB  100.00% 30.62 M
    > gcr.io/k8s-minikube/kicbase...:  487.90 MiB / 487.90 MiB  100.00% 29.64 M
ğŸ”¥  Creating docker container (CPUs=2, Memory=1963MB) ...
â—  Failing to connect to https://registry.k8s.io/ from inside the minikube container
ğŸ’¡  To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/
ğŸ³  Preparing Kubernetes v1.31.0 on Docker 27.2.0 ...
    â–ª Generating certificates and keys ...
    â–ª Booting up control plane ...
    â–ª Configuring RBAC rules ...
ğŸ”—  Configuring bridge CNI (Container Networking Interface) ...
ğŸ”  Verifying Kubernetes components...
    â–ª Using image gcr.io/k8s-minikube/storage-provisioner:v5
ğŸŒŸ  Enabled addons: storage-provisioner, default-storageclass
ğŸ„  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default
~~~

~~~console
kubectl config view

apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: DATA+OMITTED
    server: https://kubernetes.docker.internal:6443
  name: docker-desktop
- cluster:
    certificate-authority: C:\Users\í™©í•´ì—°\.minikube\ca.crt
    extensions:
    - extension:
        last-update: Mon, 25 Nov 2024 12:14:39 KST
        provider: minikube.sigs.k8s.io
        version: v1.34.0
      name: cluster_info
    server: https://127.0.0.1:59141
  name: minikube
contexts:
- context:
    cluster: docker-desktop
    namespace: kube-system
    user: docker-desktop
  name: docker-desktop
- context:
    cluster: minikube
    extensions:
    - extension:
        last-update: Mon, 25 Nov 2024 12:14:39 KST
        provider: minikube.sigs.k8s.io
        version: v1.34.0
      name: context_info
    namespace: default
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: {}
users:
- name: docker-desktop
  user:
    client-certificate-data: DATA+OMITTED
    client-key-data: DATA+OMITTED
- name: minikube
  user:
    client-certificate: C:\Users\í™©í•´ì—°\.minikube\profiles\minikube\client.crt
    client-key: C:\Users\í™©í•´ì—°\.minikube\profiles\minikube\client.key
~~~

~~~console
kubectl config use-context minikube

Switched to context "minikube"
~~~